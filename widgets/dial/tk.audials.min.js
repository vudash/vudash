/*! tk-audials v0.1.0 2016-01-25 */
"use strict";class TkAudial{constructor(a,b){if(!(this instanceof TkAudial))return new TkAudial(a,b);this.element=a;this.touchCount=0;this.parseOptions(b);this.events=new function(){var a={};this.on=function(b,c){if(!a[b])a[b]=[];a[b].push(c)};this.triggerHandler=function(b,c){if(a[b]){for(var d in a[b])a[b][d](c)}}};this.display=this.create("svg","display");if(this.options.inputId)this.inputField=this.create("input","",this.options.inputId);this.border=this.create("circle","border");this.indicatorBackground=this.create("path","indicator-background");this.indicator=this.create("path","indicator");this.valueBackground=this.create("circle","value-background");this.valueText=this.create("text","value-text");this.display.setAttributeNode(this.attribute("viewBox","0 0 230 230"));this.border.setAttributeNode(this.attribute("cx",115));this.border.setAttributeNode(this.attribute("cy",115));this.border.setAttributeNode(this.attribute("r",115));if(this.options.borderColour)this.border.setAttributeNode(this.attribute("style","fill:"+this.options.borderColour));this.border.setAttributeNode(this.attribute("stroke-width",0));this.indicatorBackground.setAttributeNode(this.attribute("d",this.doughnuts()));if(this.options.indicatorBackgroundColour)this.indicatorBackground.setAttributeNode(this.attribute("style","fill:"+this.options.indicatorBackgroundColour));this.indicatorBackground.setAttributeNode(this.attribute("stroke-width",0));if(this.options.indicatorColour)this.indicator.setAttributeNode(this.attribute("style","fill:"+this.options.indicatorColour+";stroke:"+this.options.indicatorColour));this.indicator.setAttributeNode(this.attribute("stroke-width",0));this.valueBackground.setAttributeNode(this.attribute("cx",115));this.valueBackground.setAttributeNode(this.attribute("cy",115));this.valueBackground.setAttributeNode(this.attribute("r",this.roundPlaces(115-this.options.borderWidth-this.options.indicatorWidth,2)));if(this.options.valueBackgroundColour)this.valueBackground.setAttributeNode(this.attribute("style","fill:"+this.options.valueBackgroundColour));this.valueText.setAttributeNode(this.attribute("x","50%"));this.valueText.setAttributeNode(this.attribute("y","50%"));this.valueText.setAttributeNode(this.attribute("dy",".33em"));if(this.options.valueColour)this.valueText.setAttributeNode(this.attribute("style","fill:"+this.options.valueColour+";font-size:"+this.options.valueFontSize));this.valueText.textContent=this.round(this.value,this.options.step);if(this.inputField)this.display.appendChild(this.inputField);if(this.options.enableClipboard){var c=false;var d=Array.from(document.querySelectorAll("script"));c=!d.every(function(a,b,c){return a.src.indexOf("clipboard.min.js")==-1});if(!c){this.clipboardScript=document.createElement("script");this.clipboardScript.setAttribute("type","text/javascript");this.clipboardScript.setAttribute("src","build/clipboard.min.js");this.clipboardScript.setAttribute("id","clipboard-script");document.getElementsByTagName("head")[0].appendChild(this.clipboardScript)}this.clipboarder=this.create("button","clipboarder");this.clipboarder.setAttributeNode(this.attribute("data-clipboard-text",""));this.element.appendChild(this.clipboarder)}if(this.options.borderWidth>0)this.display.appendChild(this.border);this.display.appendChild(this.indicatorBackground);this.display.appendChild(this.indicator);this.display.appendChild(this.valueBackground);this.display.appendChild(this.valueText);this.element.appendChild(this.display);if(this.element!==null)this.init()}init(){self.addEventListener("touchstart",this.touchHandler.bind(this),true);self.addEventListener("touchmove",this.touchHandler.bind(this),true);self.addEventListener("touchend",this.touchHandler.bind(this),true);self.addEventListener("touchcancel",this.touchHandler.bind(this),true);this.element.addEventListener("mousedown",this.onmousedown.bind(this),true);self.addEventListener("mousemove",this.onmousemove.bind(this),true);self.addEventListener("mouseup",this.onmouseup.bind(this),true);self.addEventListener("keyup",this.onsensitivitymodifier.bind(this),true);self.addEventListener("keydown",this.onsensitivitymodifier.bind(this),true);this.element.addEventListener("mouseover",this.onmouseover.bind(this),true);this.element.addEventListener("mouseout",this.onmouseout.bind(this),true);this.setValue(this.value)}addEventListener(a,b){this.events.on(a,b)}parseOptions(a){this.options=a||{type:"gain",display:"notch",min:0,max:100,step:1,sensitivityMultiplier:1,alwaysMultiply:true,borderColour:null,borderWidth:8,indicatorBackgroundColour:null,indicatorColour:null,indicatorWidth:15,valueBackgroundColour:null,valueColour:null,valueFontSize:"1em",inputId:null,zeroModifiers:false,enableClipboard:false,hoverHTML:null};this.value=this.userOptions==null?50:this.userOptions.value||50;if(!a)return;this.options.type=a.type||"gain";this.options.display=a.display||"notch";this.options.min=a.min==null?0:a.min;this.options.max=a.max==null?100:a.max;this.options.step=a.step==null?1:a.step;this.options.sensitivityMultiplier=a.sensitivityMultiplier==null?1:a.sensitivityMultiplier;this.options.alwaysMultiply=a.alwaysMultiply==null?true:a.alwaysMultiply;this.value=a.value==null?50:this.roundToStep(a.value);this.options.borderColour=a.borderColour;this.options.borderWidth=a.borderWidth==null?8:a.borderWidth;this.options.indicatorBackgroundColour=a.indicatorBackgroundColour;this.options.indicatorColour=a.indicatorColour;this.options.indicatorWidth=a.indicatorWidth==null?15:a.indicatorWidth;this.options.valueBackgroundColour=a.valueBackgroundColour;this.options.valueColour=a.valueColour;this.options.valueFontSize=a.valueFontSize||"1em";this.options.inputId=a.inputId;this.options.zeroModifiers=a.zeroModifiers==null?false:a.zeroModifiers;this.options.enableClipboard=a.enableClipboard==null?false:a.enableClipboard;this.options.hoverHTML=a.hoverHTML}slide(a,b){this.slideValue=a<this.options.min?this.options.min:a>this.options.max?this.options.max:a;this.valueText.textContent=this.slideValue;if(this.hover){if(this.options.hoverHTML.indexOf("$value")>-1){this.hover.textContent=this.options.hoverHTML.replace("$value",this.slideValue)}}this.drawIndicator(this.slideValue);if(b){this.element.dispatchEvent(new CustomEvent("changed",{detail:this.slideValue}));this.events.triggerHandler("changed",{value:this.slideValue})}}commitSlide(a){this.value=this.slideValue;if(this.inputField)this.inputField.setAttributeNode(this.attribute("value",this.slideValue))}setValue(a){if(isNaN(a))return;a=this.roundToStep(a);this.slide(a,false);this.commitSlide()}drawIndicator(a){if(this.options.display=="notch"){this.notch(a)}else{if(this.options.type=="gain"){this.gainFill(a)}else{this.balanceFill(a)}}}notch(a){var b="M115,115 ";var c=this.translate(a);var d=115-this.options.borderWidth-this.options.indicatorWidth;var e=115+d*Math.sin(c*Math.PI/180);var f=115-d*Math.cos(c*Math.PI/180);b+="M"+e+","+f;d=115-this.options.borderWidth;e=115+d*Math.sin(c*Math.PI/180);f=115-d*Math.cos(c*Math.PI/180);b+="L"+e+","+f;this.indicator.setAttributeNode(this.attribute("d",b));this.indicator.setAttributeNode(this.attribute("stroke-width",8))}gainFill(a){var b=this.translate(a);var c=115-this.options.borderWidth;var d=115-this.options.borderWidth-this.options.indicatorWidth;var e=115+d*Math.sin(225*Math.PI/180);var f=115-d*Math.cos(225*Math.PI/180);var g=115+c*Math.sin(225*Math.PI/180);var h=115-c*Math.cos(225*Math.PI/180);var i=115+c*Math.sin(b*Math.PI/180);var j=115-c*Math.cos(b*Math.PI/180);var k=115+d*Math.sin(b*Math.PI/180);var l=115-d*Math.cos(b*Math.PI/180);var m;if(a==this.options.min){this.notch(a);return}else{if(b>180){m="M"+e+","+f+" L"+g+","+h;m+=" A "+c+","+c+" 1 0 1 "+i+","+j;m+=" L"+k+","+l;m+=" A "+d+","+d+" 1 0 0 115,"+(this.options.borderWidth+this.options.indicatorWidth)}else{m="M"+e+","+f+" L"+g+","+h;m+=" A "+c+","+c+" 1 0 1 115,"+this.options.borderWidth;m+=" L115,"+(this.options.borderWidth+this.options.indicatorWidth);m+=" A "+d+","+d+" 1 0 0 "+e+","+f;m+="M115,"+(this.options.borderWidth+this.options.indicatorWidth)+" L115,"+this.options.borderWidth;m+=" A "+c+","+c+" 1 0 1 "+i+","+j;m+=" L"+k+","+l;m+=" A "+d+","+d+" 1 0 0 115,"+(this.options.borderWidth+this.options.indicatorWidth)}m+=" z"}this.indicator.setAttributeNode(this.attribute("d",m));this.indicator.setAttributeNode(this.attribute("stroke-width",b==225?3:0))}balanceFill(a){var b=this.translate(a);var c=115-this.options.borderWidth;var d=115-this.options.borderWidth-this.options.indicatorWidth;var e=115+c*Math.sin(b*Math.PI/180);var f=115-c*Math.cos(b*Math.PI/180);var g=115+d*Math.sin(b*Math.PI/180);var h=115-d*Math.cos(b*Math.PI/180);var i;if(b==0){this.notch(a);return}else{i="M115,"+(this.options.borderWidth+this.options.indicatorWidth)+" L115,"+this.options.borderWidth;if(b>180){i+=" A "+c+","+c+" 1 0 0 "+e+","+f;i+=" L"+g+","+h;i+=" A "+d+","+d+" 1 0 1 115,"+(this.options.borderWidth+this.options.indicatorWidth)}else{i+=" A "+c+","+c+" 1 0 1 "+e+","+f;i+=" L"+g+","+h;i+=" A "+d+","+d+" 1 0 0 115,"+(this.options.borderWidth+this.options.indicatorWidth)}i+=" z"}this.indicator.setAttributeNode(this.attribute("d",i));this.indicator.setAttributeNode(this.attribute("stroke-width",b==0?3:0))}doughnuts(){var a=115-this.options.borderWidth;var b=115-this.options.borderWidth-this.options.indicatorWidth;var c=115;var d=115;var e="M"+c+" "+(d+a)+"A"+a+" "+a+" 0 1 1 "+(c+.001)+" "+(d+a);e+="M"+c+" "+(d+b)+"A"+b+" "+b+" 0 1 0 "+(c-.001)+" "+(d+b);return e}translate(a){var b=(a-this.options.min)*(135- -135)/(this.options.max-this.options.min)+-135;if(b<0){b=360+b}return b}round(a,b){var c=this.decimalPlaces(this.options.step);return this.roundPlaces(a,c)}roundPlaces(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}roundToStep(a){var b=a-this.options.min;var c=Math.round(b/this.options.step);return this.options.min+this.options.step*c}decimalPlaces(a){var b=Math.abs(a);var c=b,d=1;while(!this.isInt(c)&&isFinite(c)){c=b*Math.pow(10,d++)}return d-1}isInt(a){return typeof a==="number"&&parseFloat(a)==parseInt(a,10)&&!isNaN(a)}touchHandler(a){if(a.type=="touchstart"){this.touchCount+=a.changedTouches.length;if(this.active){this.commitSlide();this.startY=this.clientY}}else if(a.type=="touchend"){this.touchCount-=a.changedTouches.length;if(this.touchCount<0)this.touchCount=0;if(this.active){this.commitSlide();this.startY=this.clientY}}if(!a.target.getAttribute("class")||a.target.getAttribute("class").indexOf("tk-audial")==-1)return;var b=a.changedTouches,c=b[0],d="";switch(a.type){case"touchstart":d="mousedown";break;case"touchmove":d="mousemove";break;case"touchend":d="mouseup";break;default:return}var e=document.createEvent("MouseEvent");e.initMouseEvent(d,true,true,window,1,c.screenX,c.screenY,c.clientX,c.clientY,false,false,false,false,0,null);c.target.dispatchEvent(e);a.preventDefault()}getValue(a){if(a){this.setValue(a)}else{return this.value}}create(a,b,c){var d="http://www.w3.org/2000/svg";var e=a=="svg"||a=="circle"||a=="path"||a=="text"?document.createElementNS(d,a):document.createElement(a);if(b)e.setAttributeNode(this.attribute("class",b));if(c)e.setAttributeNode(this.attribute("id",c));if(a=="input"){e.setAttributeNode(this.attribute("name",c));e.setAttributeNode(this.attribute("type","hidden"))}return e}attribute(a,b){var c=document.createAttribute(a);c.value=b;return c}hide(){this.element.style.display="none"}selectable(a){var b=document.querySelector("*");if(a===true){b.classList.remove("unselectable")}else{if(!this.valueText.classList.contains("unselectable")){b.classList.add("unselectable")}}}destroyHover(){if(this.active)return;if(this.hover){this.hover.remove();this.hover=null}if(this.touchHover){this.touchHover.remove();this.touchHover=null}}positionHover(a){if(this.hover)this.hover.setAttributeNode(this.attribute("style","top:"+(a.clientY+10)+"px;left:"+(a.clientX+10)+"px;"));if(this.touchHover){this.touchHover.setAttributeNode(this.attribute("style","top:"+(a.clientY+10)+"px;left:"+(a.clientX+10)+"px;"))}}onmouseover(a){if(this.options.hoverHTML&&!this.hover){this.hover=this.create("div","tk-audial-hover");this.hover.textContent=this.options.hoverHTML.replace("$value",this.value);this.positionHover(a);this.element.appendChild(this.hover)}}onmouseout(a){if(this.hover)this.destroyHover()}onmousedown(a){if(!this.hover&&this.options.hoverHTML&&!this.touchHover){this.touchHover=this.create("div","tk-audial-hover");this.touchHover.textContent=this.options.hoverHTML.replace("$value",this.value);this.positionHover(a);this.element.appendChild(this.touchHover)}if(a.touches)a=a.touches[0];this.startY=a.clientY;this.selectable(false);this.active=true}onmousemove(a){if(this.hover||this.touchHover){this.positionHover(a)}if(!this.startY)return;this.clientY=a.clientY;a.preventDefault();if(a.touches)a=a.touches[0];var b=(a.clientY-this.startY)*(a.altKey?2:1)*(a.shiftKey?3:1);if(this.touchCount>1){b=(a.clientY-this.startY)*this.touchCount+1}if((a.altKey||a.shiftKey||this.touchCount>1||this.options.alwaysMultiply)&&this.options.sensitivityMultiplier!=1){b=b*this.options.sensitivityMultiplier}var c=this.value+b*this.options.step*-1;var d=this.round(c);this.slide(d,true);return;var e=this.handleOffsetY+this.startY-a.clientY,f=this.steps?closest.find(e,this.steps):e;if(e<=0){this.setPosition(0)}else if(e>=this.restrictHandleY){this.setPosition(this.restrictHandleY)}else{this.setPosition(f)}this.setValue(this.handle.style.bottom,this.element.offsetHeight-this.handle.offsetHeight)}doubleClickDetect(){if(this.mouseUpCount){if(++this.mouseUpCount>1){if(window.clipboarder)this.setValue(window.clipboarder)}}else{this.mouseUpCount=1;var a=this;setTimeout(function(){a.mouseUpCount=null},500)}}onmouseup(a){if(this.active){this.active=false;if(this.hover&&a.target!=this.element){this.destroyHover()}if(this.touchHover){this.destroyHover()}this.doubleClickDetect();this.commitSlide();this.startY=null;this.selectable(true);if(this.options.zeroModifiers)this.touchCount=0;if(this.options.enableClipboard&&this.clipboarder){this.clipboarder.setAttributeNode(this.attribute("data-clipboard-text",this.getValue()));var b=new Clipboard(this.clipboarder);this.clipboarder.click();window.clipboarder=this.getValue();b.destroy()}}}onsensitivitymodifier(a){if(this.active&&(a.keyCode==16||a.keyCode==18)){this.commitSlide();this.startY=this.clientY}}}
